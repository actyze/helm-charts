{{- if .Values.secrets.create }}
---
# External LLM API Key Secret
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "dashboard.fullname" . }}-external-llm
  namespace: {{ .Values.global.namespace }}
  labels:
    {{- include "dashboard.labels" . | nindent 4 }}
  annotations:
    helm.sh/resource-policy: keep
type: Opaque
data:
  {{- if .Values.secrets.externalLLM.apiKey }}
  external-llm-api-key: {{ .Values.secrets.externalLLM.apiKey | b64enc | quote }}
  {{- else }}
  external-llm-api-key: {{ "placeholder-change-me" | b64enc | quote }}
  {{- end }}

---
# Trino Credentials Secret
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "dashboard.fullname" . }}-trino-credentials
  namespace: {{ .Values.global.namespace }}
  labels:
    {{- include "dashboard.labels" . | nindent 4 }}
  annotations:
    helm.sh/resource-policy: keep
type: Opaque
data:
  {{- if .Values.secrets.trino.username }}
  username: {{ .Values.secrets.trino.username | b64enc | quote }}
  {{- else }}
  username: {{ "trino_user" | b64enc | quote }}
  {{- end }}
  {{- if hasKey .Values.secrets.trino "password" }}
  password: {{ .Values.secrets.trino.password | b64enc | quote }}
  {{- else }}
  password: {{ "CHANGE_ME" | b64enc | quote }}
  {{- end }}

{{- if .Values.services.postgres.enabled }}
---
# PostgreSQL Database Credentials Secret
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "dashboard.fullname" . }}-postgres-credentials
  namespace: {{ .Values.global.namespace }}
  labels:
    {{- include "dashboard.labels" . | nindent 4 }}
  annotations:
    helm.sh/resource-policy: keep
type: Opaque
data:
  username: {{ .Values.secrets.postgres.username | default "dashboard_user" | b64enc | quote }}
  password: {{ .Values.secrets.postgres.password | default "dashboard_password" | b64enc | quote }}
{{- end }}

---
# Account Provisioning API Key Secret
# Used by external services (e.g., marketing dashboard) to create user accounts
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "dashboard.fullname" . }}-account-provisioning
  namespace: {{ .Values.global.namespace }}
  labels:
    {{- include "dashboard.labels" . | nindent 4 }}
  annotations:
    helm.sh/resource-policy: keep
type: Opaque
data:
  {{- if .Values.secrets.accountProvisioning.apiKey }}
  api-key: {{ .Values.secrets.accountProvisioning.apiKey | b64enc | quote }}
  {{- else }}
  api-key: {{ "CHANGE_ME_ACCOUNT_PROVISIONING_API_KEY" | b64enc | quote }}
  {{- end }}

{{- end }}
